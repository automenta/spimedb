<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="lib/leaflet/leaflet.css">        
        <link rel="stylesheet" href="lib/leaflet.markercluster/MarkerCluster.css">
        <link rel="stylesheet" href="lib/leaflet.markercluster/MarkerCluster.Default.css">




        <script src="lib/lodash.js"></script>
        <script src="lib/jquery.min.js"></script>

        <script src="lib/backbone.js"></script>


        <script src="lib/draggabilly.js"></script>

        <script src="lib/packery/packery.js"></script>

        <script src="lib/leaflet/leaflet.js"></script>
        <script src="lib/leaflet.markercluster/leaflet.markercluster.js"></script>


        <link rel="stylesheet" href="search.base.css">
        <link rel="stylesheet" href="search.css">

        <script src="util.dom.js"></script>
        <script src="util.js"></script>
        <script src="spime.js"></script>


    </head>
    <style>
        body {
            padding: 0;
        }
        leaflet-zoom-animated {
            display: none;
        }

        #query {
            position: fixed;
        }

        #settings {
            opacity: 0.9;
            position: fixed;
            z-index: 1000;
        }
    </style>

    <body>

        <div id="map"></div>

        <div id="query">
            <span id="query_edit">

                <input id="query_text" type="text" placeholder="Search"/>
                <button id="query_update">&gt;</button>

                <button id="settings">@</button>

            </span>


            <div id="querySuggestionsWrapper">
                <div id="query_suggestions" class="grid">
                </div>
            </div>
        </div>


        <div id="menu">          
            <div id="facets" class="grid">
            </div>
            <!--            <div id="resultsDragger"></div>-->
            <div id="results">

            </div>
        </div>



    </body>

<script>
    "use strict";


    $(() => {


        facets = newGrid($('#facets'));

        const map = MAP('map');


        const qs = $('#query_suggestions');

        const queryText = new QueryPrompt(
            function (suggestions) {
                if (suggestions.length === 0) {
                    qs.html('');
                } else {
                    setTimeout(() =>
                            qs.html(_.map(JSON.parse(suggestions), (x) =>
                                D('grid-item').append(
                                    D('grid-item-content').text(x).click((e) => {
                                        queryText.val(x);
                                        update(x);
                                    })
                                )
                            )),
                        0);
                }
            },
            function (result) {

            }
        );

        queryText.submit = () => {
            update(queryText.val()); //intercept this
        };


        function suggestionsClear() {
            qs.html('');
        }




        $('#settings').click(()=>{
            $('body').prepend('<iframe id="settings" src="/shell.html" width="100%" height="90%"></iframe>')
        });


//                //http://draggabilly.desandro.com/
//                $('#resultsDragger').draggabilly({
//                    axis: 'x'
//
//                }).on( 'dragMove', function( event, pointer, moveVector ) {
//
//                });





        //START ----------------->

        const Router = Backbone.Router.extend({

            routes: {
                "": "start",
            },

            start: function () {


                // setTimeout(() => {
                //
                //     facets.html('');
                //
                //     FACETS({q: '>'}, loadFacets);
                //
                // }, 0);

            }

        });

        new Router();
        Backbone.history.start();


    }, false);



</script>
</html>
