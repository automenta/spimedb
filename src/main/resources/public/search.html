<html>
<head>

    <script src="lib/lodash.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/tempo.js"></script>

</head>
<body>

<div id="query_edit">
    <span>
        <input id="query_text" type="text" placeholder="Search"/>
        <button id="query_update">Search</button>
    </span>
</div>
<div id="query_status">
</div>
<div id="query_results">
    <ul data-template>
        <h3>{{N}}</h3>
        <pre>{{I}}</pre>
        <p>{{text}}</p>
    </ul>
    <li data-template-fallback>JavaScript required</li>
</div>



</body>


<script>

    $(document).ready(()=>{

        const resultsTemplate = Tempo.prepare("query_results");

        const queryText = $('#query_text');


        const onQueryTextChanged = _.throttle(()=>{
            const qText = queryText.val();
            $('#query_status').html('Suggesting: ' + qText);
            $.get('/suggest', { q: qText }, function(result) {
                $('#query_status').html('').append($('<p>').text(result));
            });
        }, 100, true, true);
        queryText.on('input', onQueryTextChanged);

        function update(qText) {

            //$('#query_status').html('').append($('<p>').text('Query: ' + qText));

            $.get('/search', { q: qText }, function(result) {

                const rr = JSON.parse(result);
                resultsTemplate.render(rr);

            });
        }

        $('#query_update').click(function() {
            var t = queryText.val();
            update(t);
        });

    }, false );
</script>



</html>